# Template file for 'hatch'
pkgname=hatch
version=1.9.3
revision=1
build_style=python3-pep517
# ignore backend tests, because updating hatchling when there is no new hatch
# version yet breaks these in hatch.
make_check_args="--ignore tests/backend
# these tests create temporary files in /tmp, which does not work in the build
# process
 --ignore tests/cli/python/test_install.py
 --deselect tests/cli/run/test_run.py::test_scripts_no_environment
 --deselect tests/cli/env/test_create.py::test_plugin_dependencies_met
 --deselect tests/cli/env/test_create.py::test_plugin_dependencies_met_as_app"
_deps="python3-click hatchling python3-httpx python3-hyperlink
 python3-keyring python3-packaging python3-pexpect python3-platformdirs
 python3-rich python3-shellingham python3-tomli-w python3-tomlkit
 python3-userpath python3-virtualenv python3-zstandard"
hostmakedepends="hatchling hatch-vcs ${_deps}"
depends="${_deps}"
checkdepends="${_deps} python3-pytest python3-pytest-mock
 python3-pytest-xdist git python3-pip"
short_desc="Modern, extensible Python project management "
maintainer="Orphaned <orphan@voidlinux.org>"
license="MIT"
homepage="https://hatch.pypa.io/latest/"
changelog="https://raw.githubusercontent.com/pypa/hatch/master/docs/history/hatch.md"
distfiles="${PYPI_SITE}/h/hatch/hatch-${version}.tar.gz"
checksum=672017e349c548f8a957a5fee9aa2f8cfc2c8a994307378e45a8427972bdf8d9
make_check_pre="env PYTHONPATH=./src"

post_install() {
	vlicense LICENSE.txt

	for shell in zsh bash fish; do
		PYTHONPATH="${DESTDIR}/${py3_sitelib}" PATH="${DESTDIR}/usr/bin:${PATH}" \
		  _HATCH_COMPLETE="${shell}_source" hatch > "hatch.${shell}"
		vcompletion "hatch.${shell}" "${shell}"
	done
}
